<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Beat Blocks</title>

    <!-- Preload critical resources -->
    <link rel="preload" href="styles.css" as="style" />

    <link rel="preload" href="bongo.js" as="script" />
    <link
      rel="preload"
      href="assets/imgs/bongo/bongo-idle-ezgif.com-resize.png"
      as="image"
    />

 

    <!-- Non-critical CSS loaded asynchronously -->
    <link
      rel="stylesheet"
      href="styles.css"
      media="print"
      onload="this.media='all'"
    />
    <noscript><link rel="stylesheet" href="styles.css" /></noscript>

    <!-- Font Awesome with performance optimization -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      media="print"
      onload="this.media='all'"
    />
    
    <noscript
      ><link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    /></noscript>
  </head>
  <body>
  <!-- Dice Face Templates -->
  <template id="face-1">
    <span class="dot"></span>
  </template>

  <template id="face-2">
    <span class="dot"></span>
    <span class="dot"></span>
  </template>

  <template id="face-3">
    <div class="column">
      <span class="dot"></span>
    </div>
    <div class="column">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </template>

  <template id="face-4">
    <div class="column">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
    <div class="column">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </template>

  <template id="face-5">
    <div class="row-1">
      <span class="dot"></span>
    </div>
    <div class="row-2">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
    <div class="row-3">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </template>

  <template id="face-6">
    <div class="row-1">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
    <div class="row-2">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
    <div class="row-3">
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
  </template>

  <!-- Flash Overlay -->
  <div id="flash-overlay"></div>
<div class="glow"></div>
  <!-- Main Container -->
  <div class="container loading" id="page">
    
    <!-- Settings Button -->
    <div class="open-settings">
      <button id="open-settings-button" class="settings-button" onclick="openSettings()">
        <i class="fa-solid fa-gear"></i>
      </button>
    </div>

    <!-- Control Panel -->
    <div class="dice-ui">
      <!-- Hidden File Input -->
      <input type="file" id="fileInput" accept=".json,.mjson" style="display: none">

      <!-- File Controls -->
        <button onclick="uploadAudio()" class="bb-button" aria-label="Upload File">
        <i class="fa-solid fa-music"></i>
        <span class="button-text">Upload audio</span>
      </button>
<input type="file" id="audioInput" accept="audio/*" style="display:none">
      <button onclick="document.getElementById('fileInput').click()" class="bb-button" aria-label="Upload File">
        <i class="fa-solid fa-upload"></i>
        <span class="button-text">Upload</span>
      </button>

      <button onclick="downloadMJSON()" class="bb-button" aria-label="Download">
        <i class="fa-solid fa-download"></i>
        <span class="button-text">Download</span>
      </button>

      <!-- Playback Controls -->
      <button onclick="listenMode()" class="bb-button" id="listen" aria-label="Listen Mode">
        <i class="fa-solid fa-robot"></i>
        <span class="button-text">Auto</span>
      </button>

      <input type="number" id="bpm-ui" aria-label="BPM" min="40" max="240" placeholder="BPM">

      <!-- Block Controls -->
      <button onclick="removeDice()" class="bb-button" aria-label="Remove Blocks">
        <i class="fa-solid fa-minus"></i>
        <span class="button-text">Blocks</span>
      </button>

      <button onclick="addDice()" class="bb-button" aria-label="Add Blocks">
        <i class="fa-solid fa-plus"></i>
        <span class="button-text">Blocks</span>
      </button>

      <!-- Play Button -->
      <button onclick="play()" id="play" class="bb-button" aria-label="Play">
        <i id="play-icon" class="fa-solid fa-play"></i>
        <span class="button-text">Play</span>
      </button>
       <button onclick="hide_nav()" id="show" class="bb-button" aria-label="hide">
        <i id="eye-icon" class="fa-solid fa-eye"></i>
      
      </button>
    </div>

    <!-- Main Content Area -->
    <div id="container-bg">
      <!-- Title and Countdown -->
      <div class="title-row">
        <h2 id="title">Beat Blocks</h2>
        <div id="countdown">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>

      <!-- Dice Container -->
      <div class="dice-container" id="dice-container">
        <!-- Dice will be dynamically added here -->
      </div>

      <!-- Quarter Note and Cat Row -->
      <div class="row" id="cat-row" style="display: ;">
        <div class="quarter-wrapper">
          <svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" id="quarter-note-icon">
            <g id="Layer_3">
              <path d="M52.23,74.649c2.869-0.896,4.756-3.65,4.756-6.656v0h0.041V26.756c0-0.97-0.786-1.756-1.756-1.756
                s-1.756,0.786-1.756,1.756v35.196c-1.351-0.793-2.985-1.156-4.722-0.866c-2.958,0.494-5.336,2.93-5.75,5.9
                C42.338,72.054,47.057,76.265,52.23,74.649z"></path>
            </g>
          </svg>
          <p id="quarter-p"></p>
        </div>
        
        <div class="cat">
          <img src="assets/imgs/bongo/bongo-idle-ezgif.com-resize.png" id="bongo" alt="Bongo Cat" loading="lazy">
        </div>
      </div>

      <!-- Judgement Display -->
      <div id="judgement" style="color: wheat; display: none"></div>
    </div>

    <!-- Drumming Area -->
    <div id="drumming-area"></div>

    <!-- Footer -->
    <footer class="footer"></footer>
  </div>

  <!-- Sidebar -->
 <div class="sidebar" id="side">
  <div id="controls"></div>

  <div id="sidebar-wrapper">
    <p id="sidebar-block-title">Block #1</p>

    <div class="dice-preview" id="preview"></div>

    
    <select id="blocks" onchange="changeBlock()" class="combobox" style="width: 50%;">
      <option value="1">Block 1</option>
      <option value="2">Block 2</option>
      <option value="3">Block 3</option>
      <option value="4">Block 4</option>
    </select>

    <div class="rest-modal hidden" id="restModal">
      
      <div class="row" id="restDotInputs"></div>
    </div>
    <p id="sidebar-block-title">Specials</p>
    <div class="checkpoint">
      <input class="form-check-input dot-checkbox" type="checkbox" value="start" id="startCheck">
      <label class="form-check-label" for="startCheck">Start here?</label>
    </div>
 <div class="checkpoint" style="display: flex; flex-direction: column; align-items: flex-start;">
  <div style="display: flex; align-items: center;">
    <input class="form-check-input dot-checkbox" type="checkbox" value="start" id="bpmCheck">
    <label class="form-check-label" for="bpmCheck" style="margin-left: 5px;">Change BPM</label>
  </div>
  <input type="number" id="bpmInput" placeholder="0" class="combobox" style="text-align: center; margin-top: 5px;">
</div>

<div class="checkpoint">
  <input class="form-check-input dot-checkbox" type="checkbox" value="0" id="autoCheck">
  <label class="form-check-label" for="autoCheck">Auto?</label>
 
</div>
      

    <button onclick="closeSidebar()" id="close-side-button">Close</button>
  </div>
</div>


<!-- Settings Panel -->
<div class="settings-wrapper hidden" id="settings">
  <!-- Sticky Header -->
  <div class="settings-header">
    <h2>Settings</h2>
    <button id="close-settings-button" class="close-button" onclick="closeSettings()">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <!-- Scrollable Content -->
  <div class="settings-content">
    
    <!-- Audio Settings -->
    <div class="settings" style="padding-top: 0rem;">
      <h3 class="setting-section">Audio</h3>

      <p>Metronome Volume: <span id="metronomeVolumeLabel">50</span>%</p>
      <input type="range" id="metronomeSlider" min="0" max="100" value="50" class="slider">

      <p>Hitsound Volume: <span id="hitsoundVolumeLabel">50</span>%</p>
      <input type="range" id="hitsoundSlider" min="0" max="100" value="50" class="slider">

      <div class="combobox-wrapper">
        <p>Metronome Type:</p>
        <select id="metronomeTypeSelect" class="combobox">
          <option>Original</option>
          <option>Percussion</option>
          <option>Electronic</option>
          <option>Classic</option>
        </select>
      </div>

      <div class="combobox-wrapper">
        <p>Hitsound Type:</p>
        <select id="hitsoundTypeSelect" class="combobox">
          <option>Bongo</option>
          <option>Bongo 2</option>
          <option>Ping Pong</option>
          <option>Drum</option>
        </select>
      </div>

      <div class="combobox-wrapper">
        <p>Input Offset</p>
        <button id="decreaseOffset" class="bb-button" style="padding: 1rem;">Calibrate</button>
        <input type="number" id="offsetInput" placeholder="0ms" class="combobox" style="width: 100px; text-align: center;">
        <span>ms</span>
      </div>
    </div>

    <!-- Gameplay Settings -->
    <div class="settings">
      <h3 class="setting-section">Gameplay</h3>
      
      <div class="combobox-wrapper">
            <div class="tooltip" style="width: 40%;">
    <p>Input Keys</p>
   
  </div>
        <div class="keybind-input-wrapper">
          <div id="keybind-tags" class="keybind-tags"></div>
          <button id="add-keybind-btn">+ Add</button>
        </div>
      </div>

<div class="combobox-wrapper">
  <div class="tooltip">
    <p>Play sound on key press</p>
    <i class="fa-solid fa-info-circle tooltip-icon"></i>
    <span class="tooltip-text">Plays hitsound every hit. disables scheduled sounds</span>
  </div>

  <input type="checkbox" id="playHitsoundsOnHit" class="dot-checkbox" style="padding: 1rem;">
</div>

      
</style>


       <div class="combobox-wrapper">
          <div class="tooltip">
    <p>Show judgement</p>
    <i class="fa-solid fa-info-circle tooltip-icon"></i>
    <span class="tooltip-text">Enables judgements (Miss, Perfect, Good)</span>
  </div>
       
          <input type="checkbox" id="showJudge" class="dot-checkbox" style="padding: 1rem;">
      </div>
      <div class="combobox-wrapper">
            <div class="tooltip">
    <p>Show offset on judgement</p>
    <i class="fa-solid fa-info-circle tooltip-icon"></i>
    <span class="tooltip-text">Shows timings instead of judgements</span>
  </div>
       
          <input type="checkbox" id="showOffsetCheckbox" class="dot-checkbox" style="padding: 1rem;">
      </div>
    </div>

    <!-- Visual Settings -->
    <div class="settings">
      <h3 class="setting-section">Visual</h3>

      <!-- Dot Colors -->
      <div class="combobox-wrapper">
        <p style="width: 40%;">Dot Color:</p>
        <input type="color" class="dot-color-picker" id="dot-color-picker" value="#000000">
      </div>

      <div class="combobox-wrapper">
        <p style="width: 40%;">Dot Hit Color:</p>
        <input type="color" class="dot-color-picker" id="dot-hit-color-picker" value="#ffffff">
      </div>

      <div class="combobox-wrapper">
        <p style="width: 40%;">Block Inactive Color:</p>
        <input type="color" class="dot-color-picker" id="block-color-picker" value="#808080">
      </div>

      <!-- Dice Face Colors -->
      <div class="combobox-wrapper">
        <p style="width: 40%;">Face 1:</p>
        <input type="color" class="dot-color-picker" id="face-1-picker" value="#fb6354">
      </div>
      
      <div class="combobox-wrapper">
        <p style="width: 40%;">Face 2:</p>
        <input type="color" class="dot-color-picker" id="face-2-picker" value="#70b8fe">
      </div>
      
      <div class="combobox-wrapper">
        <p style="width: 40%;">Face 3:</p>
        <input type="color" class="dot-color-picker" id="face-3-picker" value="#ffd000">
      </div>
      
      <div class="combobox-wrapper">
        <p style="width: 40%;">Face 4:</p>
        <input type="color" class="dot-color-picker" id="face-4-picker" value="#c739ff">
      </div>
      
      <div class="combobox-wrapper">
        <p style="width: 40%;">Face 5:</p>
        <input type="color" class="dot-color-picker" id="face-5-picker" value="#ffa84d">
      </div>
      
      <div class="combobox-wrapper">
        <p style="width: 40%;">Face 6:</p>
        <input type="color" class="dot-color-picker" id="face-6-picker" value="#7fe2c0">
      </div>
    </div>

    <button id="reset-settings-button" class="bb-button" onclick="resetSettings()">
      Reset to default
    </button>
  </div>
</div>

<!-- Keybind Modal -->
<div id="keybind-modal" class="modal hidden">
  <div class="modal-content">
    <p>Press any key...</p>
    <button id="cancel-btn">Cancel</button>
  </div>
</div>




    
  </div>

  <!-- Scripts -->
      <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>

  <script src="js/main.js" type="module"></script>
  <script src="bongo.js" defer></script>
<!-- Offset Wizard Modal -->
<div id="offset-wizard-modal" class="modal hidden">
  <div class="modal-content" style="text-align: center; min-width: 350px;">
    
    <h3>Offset Calibration</h3>
    <p id="wizard-instructions"></p>
    
    <div id="wizard-visuals" style="
        position: relative; 
        width: auto; 
        height: 120px; 
        margin: 20px auto; 
        background: #f4f4f4; 
        border-radius: 8px; 
        overflow: visible;

        /* NEW horizontal layout */
        display: flex;
        justify-content: center;
        align-items: center;
    ">

      <div id="die-1" data-value="1" data-soundmap="[0]" 
           class="item grey first-face die-face-flip" style="touch-action: none;">
        <span class="dot silent"></span>
      </div>

      <div id="die-2" data-value="1" data-soundmap="[0]" 
           class="item grey first-face die-face-flip" style="touch-action: none;">
        <span class="dot silent"></span>
      </div>

      <div id="die-3" data-value="1" data-soundmap="[0]" 
           class="item grey first-face die-face-flip" style="touch-action: none;">
        <span class="dot"></span>
      </div>

      <div id="die-4" data-value="1" data-soundmap="[0]" 
           class="item grey first-face die-face-flip" style="touch-action: none;">
        <span class="dot silent"></span>
      </div> <!-- FIXED MISSING CLOSING TAG -->

    </div>

    <h2 id="wizard-status">Ready...</h2>
    <button id="wizard-cancel-btn" class="bb-button">Cancel</button>

  </div>
</div>

</body>
</html>
